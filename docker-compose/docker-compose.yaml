# This is an autogenerated file. Do not edit it manually.
# Use `python generate-config.py` instead.
---
services:
  mariadb:
    image: mariadb:10.11
    restart: unless-stopped
    container_name: mariadb
    hostname: mariadb
    environment:
      - MARIADB_ROOT_PASSWORD=password
      - MARIADB_DATABASE=buildbot
      - MARIADB_USER=buildmaster
      - MARIADB_PASSWORD=password
      - MARIADB_AUTO_UPGRADE=1
    network_mode: host
    healthcheck:
      test: ['CMD', "mariadb-admin", "--password=password", "--protocol", "tcp", "ping"]
    volumes:
      - ./mariadb:/var/lib/mysql:rw
      - ./mariadb.cnf:/etc/mysql/conf.d/mariadb.cnf:ro
    logging:
      driver: journald
      options:
        tag: "bb-mariadb"

  crossbar:
    image: crossbario/crossbar
    restart: unless-stopped
    container_name: crossbar
    hostname: crossbar
    network_mode: host
    logging:
      driver: journald
      options:
        tag: "bb-crossbar"

  nginx:
    image: nginx:latest
    restart: unless-stopped
    container_name: nginx
    hostname: nginx
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d/:/etc/nginx/conf.d/
      - ./nginx/templates/:/etc/nginx/templates/:ro
      - /srv/buildbot/packages:/srv/buildbot/packages:ro
      - /srv/buildbot/galera_packages:/srv/buildbot/galera_packages:ro
      - /srv/buildbot/helper_files:/srv/buildbot/helper_files:ro
      - ./logs/nginx:/var/log/nginx
      - ./certbot/www/:/var/www/certbot/:ro
      - ./certbot/ssl/:/etc/nginx/ssl/:ro
    environment:
      - NGINX_ARTIFACTS_VHOST
      - NGINX_BUILDBOT_VHOST
    network_mode: host
    logging:
      driver: journald
      options:
        tag: "bb-nginx"

  master-web:
    image: quay.io/mariadb-foundation/bb-master:dev_master-web
    restart: unless-stopped
    container_name: master-web
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MQ_ROUTER_URL
      - PORT=8010
      - TITLE
      - TITLE_URL
    hostname: master-web
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /srv/buildbot/master/docker-compose/start-bbm-web.sh
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  master-nonlatent:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: master-nonlatent
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=9996
      - TITLE
      - TITLE_URL
    hostname: master-nonlatent
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
      - /srv/buildbot/packages:/srv/buildbot/packages
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh master-nonlatent"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  master-libvirt:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: master-libvirt
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=9997
      - TITLE
      - TITLE_URL
    hostname: master-libvirt
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh master-libvirt"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  autogen_aarch64-master-0:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: autogen_aarch64-master-0
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=9998
      - TITLE
      - TITLE_URL
    hostname: autogen_aarch64-master-0
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh autogen/aarch64-master-0"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  autogen_amd64-master-0:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: autogen_amd64-master-0
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=9999
      - TITLE
      - TITLE_URL
    hostname: autogen_amd64-master-0
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh autogen/amd64-master-0"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  autogen_amd64-master-1:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: autogen_amd64-master-1
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=10000
      - TITLE
      - TITLE_URL
    hostname: autogen_amd64-master-1
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh autogen/amd64-master-1"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  autogen_ppc64le-master-0:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: autogen_ppc64le-master-0
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=10001
      - TITLE
      - TITLE_URL
    hostname: autogen_ppc64le-master-0
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh autogen/ppc64le-master-0"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  autogen_s390x-master-0:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: autogen_s390x-master-0
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=10002
      - TITLE
      - TITLE_URL
    hostname: autogen_s390x-master-0
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh autogen/s390x-master-0"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  autogen_x86-master-0:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: autogen_x86-master-0
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=10003
      - TITLE
      - TITLE_URL
    hostname: autogen_x86-master-0
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh autogen/x86-master-0"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  master-docker-nonstandard:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: master-docker-nonstandard
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=10004
      - TITLE
      - TITLE_URL
    hostname: master-docker-nonstandard
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh master-docker-nonstandard"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  master-galera:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: master-galera
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=10005
      - TITLE
      - TITLE_URL
    hostname: master-galera
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh master-galera"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  master-protected-branches:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: master-protected-branches
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=10006
      - TITLE
      - TITLE_URL
    hostname: master-protected-branches
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh master-protected-branches"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  master-docker-nonstandard-2:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: master-docker-nonstandard-2
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=10007
      - TITLE
      - TITLE_URL
    hostname: master-docker-nonstandard-2
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh master-docker-nonstandard-2"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started

  master-bintars:
    image: quay.io/mariadb-foundation/bb-master:dev_master
    restart: unless-stopped
    container_name: master-bintars
    environment:
      - ARTIFACTS_URL
      - BRANCH
      - BUILDMASTER_URL
      - BUILDMASTER_WG_IP
      - CONTAINER_REGISTRY_URL
      - CR_HOST_WG_ADDR
      - ENVIRON
      - GALERA_PACKAGES_DIR
      - MASTER_CREDENTIALS_DIR
      - MASTER_NONLATENT_BINTARS_VM_PORT
      - MASTER_NONLATENT_BINTARS_WORKERS
      - MASTER_NONLATENT_BINTARS_WORKER_PORT
      - MASTER_NONLATENT_DOCKERLIBRARY_WORKER
      - MASTER_PACKAGES_DIR
      - MC_HOST_minio=https://access_key:secret_key@minio.mariadb.org
      - MQ_ROUTER_URL
      - PORT=10008
      - TITLE
      - TITLE_URL
    hostname: master-bintars
    volumes:
      - ./logs:/var/log/buildbot
      - ./buildbot/:/srv/buildbot/master
    entrypoint:
      - /bin/bash
      - -c
      - "/srv/buildbot/master/docker-compose/start.sh master-bintars"
    network_mode: host
    depends_on:
      mariadb:
        condition: service_healthy
      crossbar:
        condition: service_started
